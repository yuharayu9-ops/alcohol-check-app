<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯å ±å‘Š</title>
    <style>
        body { font-family: "Hiragino Kaku Gothic ProN", sans-serif; background-color: #eef9ff; margin: 0; padding: 10px; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #0077b6; font-size: 1.6em; margin-bottom: 20px; border-bottom: 3px solid #caf0f8; padding-bottom: 10px; }
        .section-title { font-weight: bold; margin: 25px 0 12px; color: #023e8a; border-left: 8px solid #00b4d8; padding-left: 12px; font-size: 1.1em; }
        
        /* ãƒœã‚¿ãƒ³ï¼š1è¡Œã«2ã¤ä¸¦ã¶ãƒ‡ã‚«ãƒœã‚¿ãƒ³è¨­å®š */
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .select-btn { 
            padding: 20px 10px; 
            border: 3px solid #e0e0e0; 
            border-radius: 15px; 
            background: #fff; 
            cursor: pointer; 
            font-size: 1.2em; /* æ–‡å­—ã‚’å¤§ãã */
            font-weight: bold;
            transition: 0.2s; 
            text-align: center; 
            color: #444;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 0 #ddd;
        }
        .select-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #ddd; }
        .select-btn.active { background: #0077b6; color: white; border-color: #023e8a; box-shadow: 0 4px 0 #005f8b; }
        
        /* é…’æ°—å¸¯ã³ï¼šæœ‰ ã®æ™‚ã ã‘èµ¤ãç›®ç«‹ãŸã›ã‚‹ */
        .select-btn.danger.active { background: #d90429; border-color: #a4133c; box-shadow: 0 4px 0 #800e13; }

        /* å…¥åŠ›æ¬„ */
        textarea, input[type="text"] { 
            width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 12px; 
            box-sizing: border-box; font-size: 16px; background: #fafafa; margin-top: 5px;
        }

        .submit-btn { 
            width: 100%; padding: 22px; background: #00b4d8; color: white; border: none; 
            border-radius: 60px; font-size: 1.5em; font-weight: bold; cursor: pointer; 
            margin-top: 30px; box-shadow: 0 6px 0 #0077b6; transition: 0.1s;
        }
        .submit-btn:active { transform: translateY(3px); box-shadow: 0 3px 0 #0077b6; }
        
        #loading { text-align: center; color: #0077b6; padding: 50px; font-size: 1.2em; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸšš å®‰å…¨é‹è»¢å ±å‘Š</h2>
    <div id="loading">åç°¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>

    <div id="form-content" style="display:none;">
        <div class="section-title">ğŸ‘¤ é‹è»¢è€…ã‚’é¸ã‚“ã§ãã ã•ã„</div>
        <div id="driver-buttons" class="btn-group"></div>

        <div class="section-title">ğŸš— è»Šä¸¡ã‚’é¸ã‚“ã§ãã ã•ã„</div>
        <div id="car-buttons" class="btn-group"></div>

        <div class="section-title">ğŸ“± ç¢ºèªæ–¹æ³•ãƒ»æ¤œçŸ¥å™¨</div>
        <div class="btn-group">
            <div class="select-btn method-btn active" onclick="select('method', 'å¯¾é¢', this)">å¯¾é¢</div>
            <div class="select-btn method-btn" onclick="select('method', 'é›»è©±', this)">é›»è©±</div>
        </div>
        <div class="btn-group">
            <div class="select-btn device-btn active" onclick="select('use_device', 'ä½¿ç”¨', this)">æ¤œçŸ¥å™¨ï¼šä½¿ç”¨</div>
            <div class="select-btn device-btn" onclick="select('use_device', 'æœªä½¿ç”¨', this)">æœªä½¿ç”¨</div>
        </div>

        <div class="section-title">ğŸ· é…’æ°—å¸¯ã³ã®æœ‰ç„¡</div>
        <div class="btn-group">
            <div class="select-btn alcohol-btn active" onclick="select('has_alcohol', 'ç„¡', this)">ç„¡ (æ­£å¸¸)</div>
            <div class="select-btn alcohol-btn danger" onclick="select('has_alcohol', 'æœ‰', this)">æœ‰ (ç•°å¸¸ã‚ã‚Š)</div>
        </div>

        <div class="section-title">ğŸ“ å‚™è€ƒãƒ»ç¢ºèªè€…</div>
        <textarea id="instruction" rows="2" placeholder="ç‰¹è¨˜ãŒã‚ã‚Œã°è¨˜å…¥"></textarea>
        <input type="text" id="checker_name" placeholder="ç¢ºèªè€…ã®åå‰ï¼ˆä¸Šå¸ï¼‰">

        <button class="submit-btn" onclick="submitForm()">å ±å‘Šã‚’é€ä¿¡ï¼</button>
    </div>
</div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzwdXFvDSZ9kvbfty4XMuXgz4shRrklJCzdT_1C2EL_CgPnWpOlRve1Se741ed2A1wmTQ/exec";
    let formData = { driver_name: "", car_number: "", method: "å¯¾é¢", use_device: "ä½¿ç”¨", has_alcohol: "ç„¡" };

    window.onload = async () => {
        try {
            const response = await fetch(GAS_URL);
            const data = await response.json();
            
            const driverGroup = document.getElementById('driver-buttons');
            data.drivers.forEach(name => {
                const btn = createBtn(name, () => select('driver_name', name, btn));
                driverGroup.appendChild(btn);
            });

            const carGroup = document.getElementById('car-buttons');
            data.cars.forEach(num => {
                const btn = createBtn(num, () => select('car_number', num, btn));
                carGroup.appendChild(btn);
            });

            document.getElementById('loading').style.display = 'none';
            document.getElementById('form-content').style.display = 'block';
        } catch (e) {
            document.getElementById('loading').innerText = "ã‚¨ãƒ©ãƒ¼ï¼šåç°¿ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“";
        }
    };

    function createBtn(text, onClick) {
        const btn = document.createElement('div');
        btn.className = 'select-btn';
        btn.innerText = text;
        btn.onclick = onClick;
        return btn;
    }

    function select(key, value, element) {
        formData[key] = value;
        element.parentElement.querySelectorAll('.select-btn').forEach(btn => btn.classList.remove('active'));
        element.classList.add('active');
    }

    async function submitForm() {
        const checker = document.getElementById('checker_name').value;
        if (!formData.driver_name || !formData.car_number || !checker) return alert("ã€Œé‹è»¢è€…ã€ã€Œè»Šä¸¡ã€ã€Œç¢ºèªè€…ã€ã¯å¿…é ˆã§ã™ï¼");

        const btn = document.querySelector('.submit-btn');
        btn.disabled = true; btn.innerText = "é€ä¿¡ä¸­...";

        try {
            const payload = { ...formData, instruction: document.getElementById('instruction').value, checker_name: checker };
            await fetch(GAS_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(payload) });
            alert("å ±å‘ŠãŒå®Œäº†ã—ã¾ã—ãŸã€‚ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼");
            location.reload(); 
        } catch (e) { alert("é€ä¿¡ã‚¨ãƒ©ãƒ¼"); btn.disabled = false; }
    }
</script>
</body>
</html>
