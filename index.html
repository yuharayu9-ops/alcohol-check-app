<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯å ±å‘Š</title>
    <style>
        body { font-family: "Hiragino Kaku Gothic ProN", sans-serif; background-color: #f0f7ff; margin: 0; padding: 15px; }
        .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); }
        h2 { text-align: center; color: #0077b6; border-bottom: 2px solid #eef; padding-bottom: 10px; }
        .section-title { font-weight: bold; margin: 20px 0 10px; color: #444; border-left: 6px solid #00b4d8; padding-left: 10px; font-size: 0.95em; }
        
        /* ãƒœã‚¿ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .btn-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; margin-bottom: 10px; }
        .select-btn { padding: 12px 5px; border: 2px solid #e0e0e0; border-radius: 12px; background: #fff; cursor: pointer; font-size: 14px; transition: 0.2s; text-align: center; color: #555; }
        .select-btn.active { background: #0077b6; color: white; border-color: #0077b6; font-weight: bold; }
        .select-btn.danger.active { background: #d90429; border-color: #d90429; }

        input, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 16px; margin-bottom: 10px; background: #fafafa; }
        .submit-btn { width: 100%; padding: 20px; background: #0077b6; color: white; border: none; border-radius: 50px; font-size: 1.2em; font-weight: bold; cursor: pointer; margin-top: 25px; box-shadow: 0 4px 12px rgba(0,119,182,0.3); }
        #loading { text-align: center; color: #0077b6; padding: 40px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸšš å®‰å…¨é‹è»¢å ±å‘Š</h2>
    <div id="loading">è¨­å®šã‚’èª­ã¿è¾¼ã¿ä¸­...</div>

    <div id="form-content" style="display:none;">
        <div class="section-title">1. é‹è»¢è€…ã‚’é¸æŠ</div>
        <div id="driver-buttons" class="btn-group"></div>

        <div class="section-title">2. è»Šä¸¡ã‚’é¸æŠ</div>
        <div id="car-buttons" class="btn-group"></div>

        <div class="section-title">3. ç¢ºèªæ–¹æ³•ãƒ»æ¤œçŸ¥å™¨</div>
        <div class="btn-group">
            <div class="select-btn method-btn active" onclick="select('method', 'å¯¾é¢', this)">å¯¾é¢</div>
            <div class="select-btn method-btn" onclick="select('method', 'é›»è©±', this)">é›»è©±</div>
            <div class="select-btn method-btn" onclick="select('method', 'ãã®ä»–', this)">ãã®ä»–</div>
        </div>
        <div class="btn-group">
            <div class="select-btn device-btn active" onclick="select('use_device', 'ä½¿ç”¨', this)">æ¤œçŸ¥å™¨ä½¿ç”¨</div>
            <div class="select-btn device-btn" onclick="select('use_device', 'æœªä½¿ç”¨', this)">æœªä½¿ç”¨</div>
        </div>

        <div class="section-title">4. é…’æ°—å¸¯ã³ã®æœ‰ç„¡</div>
        <div class="btn-group">
            <div class="select-btn alcohol-btn active" onclick="select('has_alcohol', 'ç„¡', this)">ç„¡ (æ­£å¸¸)</div>
            <div class="select-btn alcohol-btn danger" onclick="select('has_alcohol', 'æœ‰', this)">æœ‰ (ç•°å¸¸)</div>
        </div>

        <div class="section-title">5. å‚™è€ƒãƒ»ç¢ºèªè€…</div>
        <textarea id="instruction" rows="2" placeholder="ç‰¹è¨˜äº‹é …ï¼ˆã‚ã‚Œã°ï¼‰"></textarea>
        <input type="text" id="checker_name" placeholder="ç¢ºèªè€…ã®åå‰ï¼ˆä¸Šå¸ï¼‰">

        <button class="submit-btn" onclick="submitForm()">å ±å‘Šã‚’é€ä¿¡ï¼</button>
    </div>
</div>

<script>
    const GAS_URL = "ã“ã“ã«GASã®URLã‚’è²¼ã‚‹";
    let formData = { driver_name: "", car_number: "", method: "å¯¾é¢", use_device: "ä½¿ç”¨", has_alcohol: "ç„¡" };

    window.onload = async () => {
        try {
            const response = await fetch(GAS_URL);
            const data = await response.json();
            
            // é‹è»¢è€…ãƒœã‚¿ãƒ³ç”Ÿæˆ
            const driverGroup = document.getElementById('driver-buttons');
            data.drivers.forEach(name => {
                const btn = createBtn(name, () => select('driver_name', name, btn));
                driverGroup.appendChild(btn);
            });

            // è»Šä¸¡ãƒœã‚¿ãƒ³ç”Ÿæˆ
            const carGroup = document.getElementById('car-buttons');
            data.cars.forEach(num => {
                const btn = createBtn(num, () => select('car_number', num, btn));
                carGroup.appendChild(btn);
            });

            document.getElementById('loading').style.display = 'none';
            document.getElementById('form-content').style.display = 'block';
        } catch (e) {
            document.getElementById('loading').innerText = "ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
        }
    };

    function createBtn(text, onClick) {
        const btn = document.createElement('div');
        btn.className = 'select-btn';
        btn.innerText = text;
        btn.onclick = onClick;
        return btn;
    }

    function select(key, value, element) {
        formData[key] = value;
        element.parentElement.querySelectorAll('.select-btn').forEach(btn => btn.classList.remove('active'));
        element.classList.add('active');
    }

    async function submitForm() {
        const checker = document.getElementById('checker_name').value;
        if (!formData.driver_name || !formData.car_number || !checker) return alert("ã€Œé‹è»¢è€…ã€ã€Œè»Šä¸¡ã€ã€Œç¢ºèªè€…ã€ã¯å¿…é ˆã§ã™");

        const btn = document.querySelector('.submit-btn');
        btn.disabled = true; btn.innerText = "é€ä¿¡ä¸­...";

        try {
            const payload = { ...formData, instruction: document.getElementById('instruction').value, checker_name: checker };
            await fetch(GAS_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(payload) });
            alert("é€ä¿¡å®Œäº†ã—ã¾ã—ãŸï¼");
            location.reload(); 
        } catch (e) { alert("ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ"); btn.disabled = false; }
    }
</script>
</body>
</html>
